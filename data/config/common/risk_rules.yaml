# 风控规则通用配置
version: "1.0"
description: "风险管理规则配置"

position_limits:
  # 仓位限制
  max_total_exposure: 0.95           # 最大总仓位95%
  max_single_symbol: 0.3             # 单个标的最大30%
  max_sector_exposure: 0.4           # 单个行业最大40%
  max_strategy_exposure: 0.5         # 单个策略最大50%
  
  # 资金限制
  min_position_value: 1000           # 最小开仓金额1000元
  max_position_value: 1000000        # 最大开仓金额100万元
  min_cash_balance: 10000            # 最小现金余额1万元

stop_loss:
  # 止损规则
  enabled: true
  types:
    percentage:
      default_value: -0.08
      min_value: -0.20
      max_value: -0.01
      
    atr_based:
     # enabled: true
      default_multiplier: 2.0        # 默认2倍ATR
      min_multiplier: 1.0
      max_multiplier: 5.0
      
    trailing:
      #enabled: true
      activation_profit: 0.05        # 盈利5%后激活
      trail_distance: 0.03           # 保持3%距离
      
    time_based:
      #enabled: false
      max_hold_days: 30

take_profit:
  # 止盈规则
  enabled: true
  types:
    percentage:
      #enabled: true
      default_value: 0.20            # 默认20%止盈
      min_value: 0.05
      max_value: 1.0
      
    risk_reward_ratio:
      #enabled: true
      default_ratio: 2.5             # 默认盈亏比2.5:1
      min_ratio: 1.0
      
    scaling_out:
      #enabled: false
      levels: [0.5, 0.3, 0.2]        # 分批止盈比例

drawdown_control:
  # 回撤控制
  max_portfolio_drawdown: -0.20      # 组合最大回撤-20%
  max_strategy_drawdown: -0.15       # 策略最大回撤-15%
  max_daily_drawdown: -0.05          # 日内最大回撤-5%
  
  actions:
    warning_at: -0.10                # -10%时警告
    reduce_at: -0.15                 # -15%时减仓
    stop_at: -0.25                   # -25%时停止交易
    reduction_factor: 0.5            # 减仓比例50%

volatility_control:
  # 波动率控制
  enabled: true
  max_daily_volatility: 0.03         # 最大日波动率3%
  max_position_volatility: 0.02      # 最大持仓波动率2%
  
  filters:
    #vix_filter: true
    vix_threshold: 30                # VIX阈值30
    
    #atr_filter: true
    atr_multiplier: 2.0
    
    #gap_filter: true
    max_gap_percent: 0.1             # 最大跳空10%

liquidity_control:
  # 流动性控制
  min_daily_volume: 1000000          # 最小日成交量100万手
  min_turnover: 10000000             # 最小成交额1000万
  max_order_volume_ratio: 0.1        # 订单量不超过日成交量10%

correlation_control:
  # 相关性控制
  enabled: true
  max_portfolio_correlation: 0.7     # 组合最大相关性0.7
  max_sector_correlation: 0.8
  diversification_min_symbols: 5     # 最少分散到5个标的

consecutive_loss:
  # 连续亏损控制
  enabled: true
  max_consecutive_losses: 3          # 最大连续亏损3次
  max_daily_losses: 5                # 最大日内亏损5次
  
  actions:
    reduce_after_loss: true
    reduction_factor: 0.5
    pause_after_losses: 3            # 连续亏损3次后暂停
    pause_duration: 3600             # 暂停1小时（秒）

time_based_rules:
  # 时间规则
  trading_hours:
    stock: "09:30-11:30,13:00-15:00"
    future: "09:00-11:30,13:00-15:00,21:00-02:30"
    
  avoid_periods:
    - "09:25-09:30"    # 集合竞价
    - "14:55-15:00"    # 收盘前
    
  max_holding_time:
    intraday: 240      # 日内最大持仓240分钟
    overnight: 10      # 隔夜最大持仓10天

circuit_breakers:
  # 熔断机制
  levels:
    - threshold: -0.07  # -7%
      action: "pause_5min"
    - threshold: -0.13  # -13%
      action: "pause_10min"
    - threshold: -0.20  # -20%
      action: "halt_trading"

alert_rules:
  # 告警规则
  triggers:
    - condition: "daily_pnl > 0.05"
      level: "info"
      channels: ["log", "console"]
      
    - condition: "daily_pnl < -0.03"
      level: "warning"
      channels: ["log", "console", "email"]
      
    - condition: "drawdown < -0.10"
      level: "alert"
      channels: ["log", "console", "email", "sms"]
      
    - condition: "position_limit_exceeded"
      level: "critical"
      channels: ["all"]

compliance_rules:
  # 合规规则
  regulatory_limits:
    max_position_percentage: 0.05    # 单一标的不超过5%
    report_threshold: 0.05           # 超过5%需要报告
    
  internal_limits:
    max_daily_turnover: 0.3          # 日换手率不超过30%
    max_trade_frequency: 100         # 最大交易频率100次/天